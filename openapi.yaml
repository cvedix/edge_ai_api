openapi: 3.0.3
info:
  title: Edge AI API
  description: REST API for Edge AI operations and management
  version: 1.0.0
  contact:
    name: Edge AI API Support

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: http://0.0.0.0:8080
    description: Default server

paths:
  /v1/core/health:
    get:
      summary: Health check endpoint
      description: Returns the health status of the API service
      operationId: getHealth
      tags:
        - Core
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                timestamp: "2024-01-01T00:00:00.000Z"
                uptime: 3600
                service: "edge_ai_api"
                version: "1.0.0"
        '500':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/core/version:
    get:
      summary: Get version information
      description: Returns version information about the API service
      operationId: getVersion
      tags:
        - Core
      responses:
        '200':
          description: Version information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionResponse'
              example:
                version: "1.0.0"
                build_time: "Jan 01 2024 00:00:00"
                git_commit: "abc123def456"
                api_version: "v1"
                service: "edge_ai_api"

  /v1/core/system/info:
    get:
      summary: Get system hardware information
      description: Returns detailed hardware information including CPU, GPU, RAM, Disk, Mainboard, OS, and Battery
      operationId: getSystemInfo
      tags:
        - Core
      responses:
        '200':
          description: System hardware information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemInfoResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    options:
      summary: CORS preflight for system info
      operationId: getSystemInfoOptions
      tags:
        - Core
      responses:
        '200':
          description: CORS preflight response

  /v1/core/system/status:
    get:
      summary: Get system status
      description: Returns current system status including CPU usage, RAM usage, load average, and uptime
      operationId: getSystemStatus
      tags:
        - Core
      responses:
        '200':
          description: System status information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStatusResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    options:
      summary: CORS preflight for system status
      operationId: getSystemStatusOptions
      tags:
        - Core
      responses:
        '200':
          description: CORS preflight response

  /v1/core/models/upload:
    post:
      summary: Upload a model file
      description: Uploads a model file (ONNX, weights, etc.) to the server. The file will be saved in the models directory.
      operationId: uploadModel
      tags:
        - Models
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Model file to upload (.onnx, .weights, .cfg, .pt, .pth, .pb, .tflite)
          application/octet-stream:
            schema:
              type: string
              format: binary
              description: Model file as binary data
      responses:
        '201':
          description: Model file uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  filename:
                    type: string
                  originalFilename:
                    type: string
                  path:
                    type: string
                  size:
                    type: integer
                  url:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: File already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    options:
      summary: CORS preflight for model upload
      operationId: uploadModelOptions
      tags:
        - Models
      responses:
        '200':
          description: CORS preflight response

  /v1/core/models/list:
    get:
      summary: List uploaded model files
      description: Returns a list of all model files that have been uploaded to the server.
      operationId: listModels
      tags:
        - Models
      responses:
        '200':
          description: List of model files
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  models:
                    type: array
                    items:
                      type: object
                      properties:
                        filename:
                          type: string
                        path:
                          type: string
                        size:
                          type: integer
                        modified:
                          type: string
                  count:
                    type: integer
                  directory:
                    type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/core/models/{modelName}:
    delete:
      summary: Delete a model file
      description: Deletes a model file from the server.
      operationId: deleteModel
      tags:
        - Models
      parameters:
        - name: modelName
          in: path
          required: true
          schema:
            type: string
          description: Name of the model file to delete
      responses:
        '200':
          description: Model file deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  filename:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Model file not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/core/instances:
    get:
      summary: List all instances
      description: Returns a list of all AI instances with summary information including running status.
      operationId: listInstances
      tags:
        - Instances
      responses:
        '200':
          description: List of instances
          content:
            application/json:
              schema:
                type: object
                properties:
                  instances:
                    type: array
                    items:
                      $ref: '#/components/schemas/InstanceSummary'
                  total:
                    type: integer
                    description: Total number of instances
                  running:
                    type: integer
                    description: Number of running instances
                  stopped:
                    type: integer
                    description: Number of stopped instances
              example:
                total: 3
                running: 1
                stopped: 2
                instances:
                  - instanceId: "550e8400-e29b-41d4-a716-446655440000"
                    displayName: "Face Detection Camera 1"
                    running: true
                    solutionId: "face_detection"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    options:
      summary: CORS preflight for list instances
      operationId: listInstancesOptions
      tags:
        - Instances
      responses:
        '200':
          description: CORS preflight response

  /v1/core/instances/{instanceId}:
    get:
      summary: Get instance details
      description: Returns detailed information about a specific instance.
      operationId: getInstance
      tags:
        - Instances
      parameters:
        - name: instanceId
          in: path
          required: true
          schema:
            type: string
          description: Instance ID (UUID)
      responses:
        '200':
          description: Instance details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceInfo'
        '404':
          description: Instance not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete an instance
      description: Deletes an instance and stops its pipeline if running.
      operationId: deleteInstance
      tags:
        - Instances
      parameters:
        - name: instanceId
          in: path
          required: true
          schema:
            type: string
          description: Instance ID (UUID)
      responses:
        '200':
          description: Instance deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  instanceId:
                    type: string
        '404':
          description: Instance not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/core/instances/{instanceId}/start:
    post:
      summary: Start an instance
      description: Starts the pipeline for an instance. The instance must have a pipeline configured.
      operationId: startInstance
      tags:
        - Instances
      parameters:
        - name: instanceId
          in: path
          required: true
          schema:
            type: string
          description: Instance ID (UUID)
      responses:
        '200':
          description: Instance started successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/InstanceInfo'
                  - type: object
                    properties:
                      message:
                        type: string
        '400':
          description: Failed to start instance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Instance not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/core/instances/{instanceId}/stop:
    post:
      summary: Stop an instance
      description: Stops the pipeline for an instance.
      operationId: stopInstance
      tags:
        - Instances
      parameters:
        - name: instanceId
          in: path
          required: true
          schema:
            type: string
          description: Instance ID (UUID)
      responses:
        '200':
          description: Instance stopped successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/InstanceInfo'
                  - type: object
                    properties:
                      message:
                        type: string
        '400':
          description: Failed to stop instance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Instance not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/core/instances/{instanceId}/restart:
    post:
      summary: Restart an instance
      description: Restarts an instance by stopping it (if running) and then starting it again. This is useful for applying configuration changes or recovering from errors.
      operationId: restartInstance
      tags:
        - Instances
      parameters:
        - name: instanceId
          in: path
          required: true
          schema:
            type: string
          description: Instance ID (UUID)
      responses:
        '200':
          description: Instance restarted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/InstanceInfo'
                  - type: object
                    properties:
                      message:
                        type: string
        '400':
          description: Failed to restart instance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Instance not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    options:
      summary: CORS preflight for restart instance
      operationId: restartInstanceOptions
      tags:
        - Instances
      responses:
        '200':
          description: CORS preflight response

  /v1/core/instance:
    post:
      summary: Create a new AI instance
      description: Creates and registers a new AI instance with the specified configuration. Returns the instance ID (UUID).
      operationId: createInstance
      tags:
        - Instances
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInstanceRequest'
            example:
              name: "Face Detection Camera 1"
              group: "cameras"
              solution: "face_detection"
              persistent: true
              frameRateLimit: 30
              metadataMode: true
              statisticsMode: true
              diagnosticsMode: false
              debugMode: false
              detectorMode: "SmartDetection"
              detectionSensitivity: "Medium"
              movementSensitivity: "Low"
              sensorModality: "RGB"
              autoStart: true
              autoRestart: false
              blockingReadaheadQueue: false
              inputOrientation: 0
              inputPixelLimit: 1920
              RTSP_URL: "rtsp://localhost:8554/stream"
      responses:
        '201':
          description: Instance created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceInfo'
              example:
                instanceId: "550e8400-e29b-41d4-a716-446655440000"
                displayName: "Face Detection Camera 1"
                group: "cameras"
                solutionId: "face_detection"
                solutionName: "Face Detection"
                persistent: true
                loaded: true
                running: true
                fps: 0.0
                version: "2025.0.1.2"
                frameRateLimit: 30
                metadataMode: true
                statisticsMode: true
                diagnosticsMode: false
                debugMode: false
                readOnly: false
                autoStart: true
                autoRestart: false
                systemInstance: false
                inputPixelLimit: 1920
                inputOrientation: 0
                detectorMode: "SmartDetection"
                detectionSensitivity: "Medium"
                movementSensitivity: "Low"
                sensorModality: "RGB"
                originator:
                  address: ""
        '400':
          description: Bad request (validation failed)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - timestamp
        - uptime
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          description: Health status of the service
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          description: Current timestamp in ISO 8601 format
          example: "2024-01-01T00:00:00.000Z"
        uptime:
          type: integer
          format: int64
          description: Service uptime in seconds
          example: 3600
        service:
          type: string
          description: Service name
          example: "edge_ai_api"
        version:
          type: string
          description: Service version
          example: "1.0.0"

    VersionResponse:
      type: object
      required:
        - version
        - api_version
        - service
      properties:
        version:
          type: string
          description: Application version
          example: "1.0.0"
        build_time:
          type: string
          description: Build timestamp
          example: "Jan 01 2024 00:00:00"
        git_commit:
          type: string
          description: Git commit hash
          example: "abc123def456"
        api_version:
          type: string
          description: API version
          example: "v1"
        service:
          type: string
          description: Service name
          example: "edge_ai_api"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
        code:
          type: integer
          description: Error code
        message:
          type: string
          description: Detailed error message

    SystemInfoResponse:
      type: object
      description: System hardware information
      properties:
        cpu:
          type: object
          properties:
            vendor:
              type: string
              example: "GenuineIntel"
            model:
              type: string
              example: "Intel(R) Core(TM) i7-10700K CPU @ 3.80GHz"
            physical_cores:
              type: integer
              example: 8
            logical_cores:
              type: integer
              example: 16
            max_frequency:
              type: integer
              description: Maximum frequency in MHz
              example: 3792
            regular_frequency:
              type: integer
              description: Regular frequency in MHz
              example: 3792
            min_frequency:
              type: integer
              description: Minimum frequency in MHz (-1 if not available)
              example: -1
            current_frequency:
              type: integer
              description: Current frequency in MHz (-1 if not available)
              example: 3792
            cache_size:
              type: integer
              format: int64
              description: Cache size in bytes
              example: 16777216
        ram:
          type: object
          properties:
            vendor:
              type: string
              example: "Corsair"
            model:
              type: string
              example: "CMK32GX4M2Z3600C18"
            name:
              type: string
              example: "Physical Memory"
            serial_number:
              type: string
              example: "N/A"
            size_mib:
              type: integer
              format: int64
              description: Total size in MiB
              example: 65437
            free_mib:
              type: integer
              format: int64
              description: Free memory in MiB
              example: 54405
            available_mib:
              type: integer
              format: int64
              description: Available memory in MiB
              example: 54405
        gpu:
          type: array
          items:
            type: object
            properties:
              vendor:
                type: string
                example: "NVIDIA"
              model:
                type: string
                example: "NVIDIA GeForce RTX 3070 Ti"
              driver_version:
                type: string
                example: "31.0.15.2698"
              memory_mib:
                type: integer
                format: int64
                description: Memory size in MiB
                example: 8190
              min_frequency:
                type: integer
                example: -1
              current_frequency:
                type: integer
                description: Current frequency in MHz
                example: 0
              max_frequency:
                type: integer
                example: -1
        disk:
          type: array
          items:
            type: object
            properties:
              vendor:
                type: string
                example: "(Standard disk drives)"
              model:
                type: string
                example: "WD_BLACK SN850 Heatsink 1TB"
              serial_number:
                type: string
                example: "***"
              size_bytes:
                type: integer
                format: int64
                description: Total size in bytes
                example: 1000202273280
              free_size_bytes:
                type: integer
                format: int64
                description: Free size in bytes
                example: 500000000000
              volumes:
                type: array
                items:
                  type: string
                description: List of volume/partition names
        mainboard:
          type: object
          properties:
            vendor:
              type: string
              example: "ASUSTeK COMPUTER INC."
            name:
              type: string
              example: "PRIME Z490-A"
            version:
              type: string
              example: "Rev 1.xx"
            serial_number:
              type: string
              example: "N/A"
        os:
          type: object
          properties:
            name:
              type: string
              example: "Ubuntu 22.04 LTS"
            short_name:
              type: string
              example: "Linux"
            version:
              type: string
              example: "22.04"
            kernel:
              type: string
              example: "5.15.0-72-generic"
            architecture:
              type: string
              example: "64 bit"
            endianess:
              type: string
              example: "little endian"
        battery:
          type: array
          description: Battery information (empty array if no batteries)
          items:
            type: object
            properties:
              vendor:
                type: string
              model:
                type: string
              serial_number:
                type: string
              technology:
                type: string
              capacity_mwh:
                type: integer
                format: int64
                description: Capacity in mWh
              charging:
                type: boolean
                description: Whether battery is charging

    SystemStatusResponse:
      type: object
      description: Current system status
      properties:
        cpu:
          type: object
          properties:
            usage_percent:
              type: number
              format: double
              description: CPU usage percentage (0-100)
              example: 25.5
            current_frequency_mhz:
              type: integer
              description: Current CPU frequency in MHz (-1 if not available)
              example: 3792
            temperature_celsius:
              type: number
              format: double
              description: CPU temperature in Celsius (optional, -1 if not available)
              example: 45.5
        ram:
          type: object
          properties:
            total_mib:
              type: integer
              format: int64
              description: Total RAM in MiB
              example: 65437
            used_mib:
              type: integer
              format: int64
              description: Used RAM in MiB
              example: 11032
            free_mib:
              type: integer
              format: int64
              description: Free RAM in MiB
              example: 54405
            available_mib:
              type: integer
              format: int64
              description: Available RAM in MiB
              example: 54405
            usage_percent:
              type: number
              format: double
              description: RAM usage percentage (0-100)
              example: 16.85
            cached_mib:
              type: integer
              format: int64
              description: Cached memory in MiB (optional)
              example: 5000
            buffers_mib:
              type: integer
              format: int64
              description: Buffers memory in MiB (optional)
              example: 1000
        load_average:
          type: object
          properties:
            "1min":
              type: number
              format: double
              description: Load average for 1 minute
              example: 0.75
            "5min":
              type: number
              format: double
              description: Load average for 5 minutes
              example: 0.82
            "15min":
              type: number
              format: double
              description: Load average for 15 minutes
              example: 0.88
        uptime_seconds:
          type: integer
          format: int64
          description: System uptime in seconds
          example: 86400
          description: Error code
        message:
          type: string
          description: Detailed error message

    CreateInstanceRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: "Instance name (required, pattern: ^[A-Za-z0-9 -_]+$)"
          example: "Face Detection Camera 1"
        group:
          type: string
          description: "Group name (optional, pattern: ^[A-Za-z0-9 -_]+$)"
          example: "cameras"
        solution:
          type: string
          description: Solution ID (optional, must match existing solution)
          example: "face_detection"
        persistent:
          type: boolean
          description: Save instance to JSON file
          default: false
        frameRateLimit:
          type: integer
          description: Frame rate limit (FPS)
          default: 0
          minimum: 0
        metadataMode:
          type: boolean
          description: Enable metadata mode
          default: false
        statisticsMode:
          type: boolean
          description: Enable statistics mode
          default: false
        diagnosticsMode:
          type: boolean
          description: Enable diagnostics mode
          default: false
        debugMode:
          type: boolean
          description: Enable debug mode
          default: false
        detectorMode:
          type: string
          description: Detector mode
          enum: [SmartDetection]
          default: "SmartDetection"
        detectionSensitivity:
          type: string
          description: Detection sensitivity level
          enum: [Low, Medium, High]
          default: "Low"
        movementSensitivity:
          type: string
          description: Movement sensitivity level
          enum: [Low, Medium, High]
          default: "Low"
        sensorModality:
          type: string
          description: Sensor modality
          enum: [RGB, Thermal]
          default: "RGB"
        autoStart:
          type: boolean
          description: Automatically start instance when created
          default: false
        autoRestart:
          type: boolean
          description: Automatically restart instance on error
          default: false
        blockingReadaheadQueue:
          type: boolean
          description: Use blocking readahead queue
          default: false
        inputOrientation:
          type: integer
          description: Input orientation (0-3)
          default: 0
          minimum: 0
          maximum: 3
        inputPixelLimit:
          type: integer
          description: Input pixel limit
          default: 0
          minimum: 0
        RTSP_URL:
          type: string
          description: RTSP URL for source (required for face_detection solution)
          example: "rtsp://localhost:8554/stream"
        additionalParams:
          type: object
          description: Additional solution-specific parameters
          additionalProperties:
            type: string

    InstanceSummary:
      type: object
      properties:
        instanceId:
          type: string
          description: Unique instance identifier (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        displayName:
          type: string
          description: Display name of the instance
          example: "Face Detection Camera 1"
        group:
          type: string
          description: Group name
          example: "cameras"
        solutionId:
          type: string
          description: Solution ID
          example: "face_detection"
        solutionName:
          type: string
          description: Solution name
          example: "Face Detection"
        running:
          type: boolean
          description: Whether instance pipeline is running
        loaded:
          type: boolean
          description: Whether instance is loaded
        persistent:
          type: boolean
          description: Whether instance is persisted to storage
        fps:
          type: number
          format: double
          description: Current frames per second

    InstanceInfo:
      type: object
      required:
        - instanceId
        - displayName
      properties:
        instanceId:
          type: string
          description: Unique instance identifier (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        displayName:
          type: string
          description: Display name of the instance
          example: "Face Detection Camera 1"
        group:
          type: string
          description: Group name
          example: "cameras"
        solutionId:
          type: string
          description: Solution ID
          example: "face_detection"
        solutionName:
          type: string
          description: Solution name
          example: "Face Detection"
        persistent:
          type: boolean
          description: Whether instance is persisted to storage
        loaded:
          type: boolean
          description: Whether instance is loaded
        running:
          type: boolean
          description: Whether instance pipeline is running
        fps:
          type: number
          format: double
          description: Current frames per second
        version:
          type: string
          description: CVEDIX SDK version
        frameRateLimit:
          type: integer
          description: Frame rate limit
        metadataMode:
          type: boolean
          description: Metadata mode enabled
        statisticsMode:
          type: boolean
          description: Statistics mode enabled
        diagnosticsMode:
          type: boolean
          description: Diagnostics mode enabled
        debugMode:
          type: boolean
          description: Debug mode enabled
        readOnly:
          type: boolean
          description: Read-only flag
        autoStart:
          type: boolean
          description: Auto-start enabled
        autoRestart:
          type: boolean
          description: Auto-restart enabled
        systemInstance:
          type: boolean
          description: System instance flag
        inputPixelLimit:
          type: integer
          description: Input pixel limit
        inputOrientation:
          type: integer
          description: Input orientation
        detectorMode:
          type: string
          description: Detector mode
        detectionSensitivity:
          type: string
          description: Detection sensitivity
        movementSensitivity:
          type: string
          description: Movement sensitivity
        sensorModality:
          type: string
          description: Sensor modality
        originator:
          type: object
          properties:
            address:
              type: string
              description: Originator address

tags:
  - name: Core
    description: Core API endpoints for health and version information
  - name: Instances
    description: AI instance management endpoints (create, list, start, stop, delete)
  - name: Models
    description: Model file management endpoints

